<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jaxws="http://cxf.apache.org/jaxws"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:beans="http://www.springframework.org/schema/beans"
       xmlns:jaxrs="http://cxf.apache.org/jaxrs"
       xmlns:cxf="http://cxf.apache.org/core"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
       http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
       http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd
       http://cxf.apache.org/core  http://cxf.apache.org/schemas/core.xsd">

    <import resource="classpath:META-INF/cxf/cxf.xml" />
    <import resource="classpath:META-INF/cxf/cxf-servlet.xml" />

    <bean id="oidService" class="fi.vm.sade.oid.service.simple.OIDServiceSimpleImpl" />

    <jaxws:client id="organisaatioService"
                  serviceClass="fi.vm.sade.organisaatio.api.model.OrganisaatioService"
                  address="${organisaatio.webservice.url.backend}"/>

    <jaxws:client id="koodiPublicService"
                  serviceClass="fi.vm.sade.koodisto.service.KoodiService"
                  address="${koodi.public.webservice.url.backend}"/>

    <jaxws:client id="koodistoPublicService"
                  serviceClass="fi.vm.sade.koodisto.service.KoodistoService"
                  address="${koodisto.public.webservice.url.backend}"/>
    <jaxws:client id="userService"
                  serviceClass="fi.vm.sade.authentication.service.UserService"
                  address="${user.webservice.url.backend}"/>

    <bean id="tarjontaAdminService" class="fi.vm.sade.tarjonta.service.impl.TarjontaAdminServiceImpl"/>
    <bean id="tarjontaPublicService" class="fi.vm.sade.tarjonta.service.impl.TarjontaPublicServiceImpl"/>

    <bean id="tarjontaPublicationRESTService" class="fi.vm.sade.tarjonta.service.impl.TarjontaPublicationRESTService"/>
    <bean id="tarjontaExceptionMapper" class="fi.vm.sade.tarjonta.service.impl.TarjontaPublicationExceptionMapper"/>

    <beans:bean id="tarjontaHakuResource" class="fi.vm.sade.tarjonta.service.impl.resources.HakuResourceImpl"/>
    <bean id="tarjontaHakukohdeResource" class="fi.vm.sade.tarjonta.service.impl.resources.HakukohdeResourceImpl"/>
    <bean id="tarjontaKomoResource" class="fi.vm.sade.tarjonta.service.impl.resources.KomoResourceImpl" />
    <bean id="tarjontaKomotoResource" class="fi.vm.sade.tarjonta.service.impl.resources.KomotoResourceImpl" />

    <!-- API V1 -->
    <bean id="yhteyshenkiloResourceV1" class="fi.vm.sade.tarjonta.service.impl.resources.v1.YhteyshenkiloResourceImplV1" />
    <bean id="tarjontaHakuResourceV1" class="fi.vm.sade.tarjonta.service.impl.resources.v1.HakuResourceImplV1" />
    <bean id="tarjontaHakukohdeResourceV1" class="fi.vm.sade.tarjonta.service.impl.resources.v1.HakukohdeResourceImplV1" />
    <bean id="tarjontaKoulutusResourceV1" class="fi.vm.sade.tarjonta.service.impl.resources.v1.KoulutusResourceImplV1" />
    <bean id="tarjontaTilaResourceV1" class="fi.vm.sade.tarjonta.service.impl.resources.v1.TilaResourceImplV1" />
    <bean id="tarjontaLocalisationResourceV1" class="fi.vm.sade.tarjonta.service.impl.resources.v1.LocalisationResourceImplV1" />

    <!--
      Needed to convert wsdl generated dtos to json. (no @XmlRootElement annotation)
    -->
    <bean id="tarjontaObjectMapper" class="org.codehaus.jackson.map.ObjectMapper"/>
    <bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="targetObject" ref="tarjontaObjectMapper"/>
        <property name="targetMethod" value="configure"/>
        <property name="arguments">
            <util:list>
                <util:constant static-field="org.codehaus.jackson.map.SerializationConfig.Feature.INDENT_OUTPUT"/>
                <util:constant static-field="java.lang.Boolean.TRUE"/>
            </util:list>
        </property>
    </bean>
    <bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="targetObject" ref="tarjontaObjectMapper"/>
        <property name="targetMethod" value="configure"/>
        <property name="arguments">
            <util:list>
                <util:constant static-field="org.codehaus.jackson.map.SerializationConfig.Feature.WRITE_NULL_PROPERTIES"/>
                <util:constant static-field="java.lang.Boolean.FALSE"/>
            </util:list>
        </property>
    </bean>
    <bean id="tarjontaJacksonJsonProvider" class="org.codehaus.jackson.jaxrs.JacksonJsonProvider">
        <property name="mapper" ref="tarjontaObjectMapper"/>
    </bean>

    <!-- CORS (cross domain) support for rest services -->
    <bean id="cors-filter" class="org.apache.cxf.rs.security.cors.CrossOriginResourceSharingFilter"/>
    <!--
        REST Services
    -->
    <jaxrs:server id="tarjontaPublicationREST" address="/rest">
        <jaxrs:serviceBeans>
            <!-- API V0 -->
            <ref bean="tarjontaPublicationRESTService" />
            <ref bean="tarjontaHakuResource" />
            <ref bean="tarjontaHakukohdeResource" />
            <ref bean="tarjontaKomoResource"/>
            <ref bean="tarjontaKomotoResource"/>
            <ref bean="indexerResource"/>

            <!-- API V1 -->
            <ref bean="tarjontaTilaResourceV1"/>
            <ref bean="tarjontaHakuResourceV1"/>
            <ref bean="tarjontaHakukohdeResourceV1"/>
            <ref bean="tarjontaKoulutusResourceV1"/>
            <ref bean="tarjontaLocalisationResourceV1"/>
            <ref bean="yhteyshenkiloResourceV1"/>

        </jaxrs:serviceBeans>
        <jaxrs:providers>
            <ref bean="cors-filter" />
<!--             <ref bean="tarjontaExceptionMapper"/> -->
            <ref bean="tarjontaJacksonJsonProvider" />
        </jaxrs:providers>
    </jaxrs:server>

    <jaxws:endpoint xmlns="http://cxf.apache.org/jaxws" address="/services/tarjontaAdminService" implementor="#tarjontaAdminService" serviceName="tns:TarjontaAdminService" xmlns:tns="http://service.tarjonta.sade.vm.fi/"/>
    <jaxws:endpoint xmlns="http://cxf.apache.org/jaxws" address="/services/tarjontaPublicService" implementor="#tarjontaPublicService" serviceName="tns:TarjontaPublicService" xmlns:tns="http://service.tarjonta.sade.vm.fi/"/>



    <!-- Swagger API listing resource -->
    <bean id="swaggerResourceJSON" class="com.wordnik.swagger.jaxrs.listing.ApiListingResourceJSON" />

    <!-- Swagger writers -->
    <bean id="resourceWriter" class="com.wordnik.swagger.jaxrs.listing.ResourceListingProvider" />
    <bean id="apiWriter" class="com.wordnik.swagger.jaxrs.listing.ApiDeclarationProvider" />

    <bean class="org.apache.cxf.jaxrs.JAXRSServerFactoryBean" init-method="create">
        <property name="address" value="/" />
        <property name="serviceBeans">
            <list>

                <ref bean="tarjontaHakuResourceV1"/>
                <ref bean="tarjontaHakukohdeResourceV1"/>
                <!-- your resources go here -->
                <!-- ... -->
                <!-- ... -->
                <!-- Swagger API Listing resource -->
                <ref bean="swaggerResourceJSON" />
            </list>
        </property>
        <property name="providers">
            <list>
                <!-- any other providers you need go here -->
                <!-- ... -->
                <!-- ... -->
                <!-- required for writing swagger classes -->
                <ref bean="resourceWriter" />
                <ref bean="apiWriter" />
            </list>
        </property>
    </bean>

    <bean id="swaggerConfig" class="com.wordnik.swagger.jaxrs.config.BeanConfig">
        <property name="resourcePackage" value="fi.vm.sade.tarjonta.service.resources.v1"/>
        <property name="version" value="1.0.0"/>
        <property name="basePath" value="https://${host.virkailija}/tarjonta-service/rest"/>
        <property name="title" value="Tarjonta resources ${host.virkailija}"/>
        <property name="description" value="Tarjonta offered resources"/>
        <property name="contact" value=""/>
        <property name="license" value="Apache 2.0 License"/>
        <property name="licenseUrl" value="http://www.apache.org/licenses/LICENSE-2.0.html"/>
        <property name="scan" value="true"/>
    </bean>

</beans>
